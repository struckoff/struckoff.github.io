<!DOCTYPE html>
<html>
 <head>
  <title>Object kalk 5</title>
   <link href='http://fonts.googleapis.com/css?family=Finger+Paint' rel='stylesheet' type='text/css'>
   <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <meta charset="utf-8">
   <style>body {zoom:120%}</style> 
 </head>
 <body>
     
   <script>
        //<![CDATA[
     	 //массив операций, могущий быть прочитанным из JSON-файла
    
     
       function Calc(container){
         
         $(container).append("   <p>Описания операций:<input id='opersrc' value='quest.json' ><button style='background:red' id='loadOp'>Загрузить</button></p><select style='display:none' id='selOp'><option>Выберите действие:</option></select> <span id='args'></span> <p id='rp' style='display:none'>Результат: <span id='r'></span></p> ").css("background","silver");
         
           console.log(self) 
           //инициализация
           var self = this;
           console.log(self)
           this.operations = {};
           $("#loadOp").on("click", function(){self.getOperations()} );
            
         
           //заполнение объекта-калькулятора операциями
           this.getOperations = function(){
               $.get($("#opersrc").val(), function(operations){
                   for (var k in operations) 
                        self[k] = new Function(operations[k][1]);
                   self.operations = operations;
                   self.buildSelect();
                   $("#selOp").show();
                 
                   $("#selOp").on("change", function(){
                       console.log($(this))
                       self.buildInputs(      $(this).val()          );
                   })
               })
               
           }
         
        
           //построение списка операций для выбора
           this.buildSelect = function(){
              for (k in this.operations) 
                $("#selOp").append("<option value='" + k + "'>" + k + "</option>");         
           }

           
           
           //построение полей ввода по количеству операндов (аргументов)
           this.buildInputs = function(val){
           	 var args = this.operations[   val    ][0];
             
             $("#args").html("").append(" для аргументов ");
           	 for (var i = 0; i < args; i++)
                $("#args").append("<input class='in'>");
               
             $( "<button>Вычислить</button>" ).appendTo( "#args" ).on("click", function(){
                  var vals = $(".in").map(function(){return $(this).val()}).get(); //получить массив аргументов
                  $("#r").html(       self[  val   ].apply(null, vals)    );
                  $("#selOp")[0].selectedIndex = 0; 
                  $("#rp").show();
             });
           } 
         }
     
     
     
     
     
 		$("body").append("<h1>Object kalk 5</h1><div id='forCalc'></div>").css("font-family", "Finger Paint");
         var kalk = new Calc(   "#forCalc"    );
     
     
     
     	 
           
         
     
     	//]]>
   </script>
 </body>
</html>